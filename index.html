<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image to Text Free Converter</title>
    <link rel="icon" href="https://img.icons8.com/color/48/scanner.png">
    
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Amiri&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #4361ee;
            --primary-hover: #3a0ca3;
            --bg: #f8f9fa;
            --card-bg: #ffffff;
            --text: #2b2d42;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); color: var(--text); padding-bottom: 50px; }

        /* HEADER */
        .navbar { background: var(--card-bg); padding: 15px 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: center; position: sticky; top: 0; z-index: 999; }
        .logo { font-size: 22px; font-weight: 700; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        
        /* MAIN CONTAINER */
        .container { max-width: 850px; margin: 30px auto; padding: 0 15px; }
        .header-text { text-align: center; margin-bottom: 30px; }
        .header-text h1 { font-size: 1.8rem; font-weight: 700; margin-bottom: 8px; color: #111; }
        .header-text p { color: #666; font-size: 0.95rem; }

        /* CARD TOOL */
        .tool-card { background: var(--card-bg); border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.08); overflow: hidden; border: 1px solid #edf2f4; }

        /* 1. SELECTOR BAHASA */
        .language-bar { background: #f1f5f9; padding: 15px 20px; border-bottom: 1px solid #e2e8f0; display: flex; flex-direction: column; gap: 8px; }
        .language-bar label { font-size: 0.85rem; font-weight: 600; color: #475569; }
        select { padding: 10px; border-radius: 8px; border: 1px solid #cbd5e1; font-family: inherit; font-size: 14px; width: 100%; cursor: pointer; background: white; outline: none; }
        
        /* 2. AREA UPLOAD */
        .upload-area { padding: 30px 20px; text-align: center; cursor: pointer; transition: 0.3s; }
        .dropzone { border: 2px dashed #cbd5e1; border-radius: 12px; padding: 40px 20px; background: #f8fafc; transition: 0.3s; }
        .dropzone:hover { border-color: var(--primary); background: #eff6ff; }
        .dropzone i { font-size: 50px; color: var(--primary); margin-bottom: 15px; }
        .dropzone h3 { font-size: 16px; margin-bottom: 5px; }
        .dropzone p { font-size: 12px; color: #94a3b8; }

        /* 3. PREVIEW & STATUS */
        .preview-box { display: flex; gap: 10px; padding: 0 20px 20px; overflow-x: auto; display: none; }
        .thumb { width: 70px; height: 70px; object-fit: cover; border-radius: 8px; border: 1px solid #ddd; }
        
        .status-bar { text-align: center; padding: 10px 20px; font-size: 14px; color: var(--primary); font-weight: 500; display: none; }

        /* 4. TOMBOL AKSI */
        .action-area { padding: 0 20px 30px; }
        .btn-main { width: 100%; background: var(--primary); color: white; border: none; padding: 14px; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: 0.2s; display: flex; justify-content: center; align-items: center; gap: 8px; box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3); }
        .btn-main:disabled { background: #94a3b8; box-shadow: none; cursor: not-allowed; }
        .btn-main:hover:not(:disabled) { background: var(--primary-hover); transform: translateY(-2px); }

        /* 5. HASIL & DOWNLOAD */
        .result-area { display: none; border-top: 1px solid #e2e8f0; }
        .result-toolbar { padding: 15px 20px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
        .toolbar-title { font-weight: 600; font-size: 14px; color: #333; }
        
        .btn-group { display: flex; gap: 8px; }
        .btn-small { padding: 6px 12px; border: 1px solid #cbd5e1; background: white; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 5px; color: #333; }
        .btn-small:hover { background: #f1f5f9; border-color: #94a3b8; }
        
        textarea { width: 100%; height: 350px; border: none; padding: 20px; font-family: 'Poppins', sans-serif; font-size: 15px; line-height: 1.7; color: #333; resize: none; outline: none; }
        
        /* MODE KHUSUS ARAB (RTL) */
        .rtl-mode { direction: rtl; text-align: right; font-family: 'Amiri', serif; font-size: 18px; }

        /* Footer */
        .footer { text-align: center; margin-top: 40px; font-size: 12px; color: #aaa; }
    </style>
</head>
<body>

<nav class="navbar">
    <div class="logo"><i class="fas fa-expand"></i> ImageToText<span style="color:#333">Free</span></div>
</nav>

<div class="container">
    <div class="header-text">
        <h1>Konverter Gambar ke Teks</h1>
        <p>Alat OCR gratis: Ubah foto menjadi teks yang bisa diedit (Word/TXT)</p>
    </div>

    <div class="tool-card">
        <div class="language-bar">
            <label><i class="fas fa-globe"></i> BAHASA DOKUMEN:</label>
            <select id="langSelect">
                <option value="ara+eng+ind">âš¡ Auto Detect (Semua Bahasa)</option>
                <option value="ara">ðŸ‡¸ðŸ‡¦ Arabic (Kitab/Quran/Hadits)</option>
                <option value="ind">ðŸ‡®ðŸ‡© Indonesian</option>
                <option value="tur">ðŸ‡¹ðŸ‡· Turkish</option>
                <option value="eng">ðŸ‡ºðŸ‡¸ English</option>
            </select>
        </div>

        <div class="upload-area" onclick="document.getElementById('fileIn').click()">
            <div class="dropzone">
                <i class="fas fa-cloud-upload-alt"></i>
                <h3>Klik untuk Pilih Gambar</h3>
                <p>Mendukung JPG, PNG, BMP (Bisa banyak sekaligus)</p>
            </div>
            <input type="file" id="fileIn" hidden multiple accept="image/*">
        </div>

        <div class="preview-box" id="previewBox"></div>
        <div class="status-bar" id="statusBar">Siap memproses...</div>

        <div class="action-area">
            <button id="startBtn" class="btn-main" disabled>
                <i class="fas fa-magic"></i> Mulai Konversi
            </button>
        </div>

        <div class="result-area" id="resultArea">
            <div class="result-toolbar">
                <span class="toolbar-title">Hasil:</span>
                <div class="btn-group">
                    <button class="btn-small" onclick="copyText()"><i class="far fa-copy"></i> Salin</button>
                    <button class="btn-small" onclick="dlTxt()"><i class="fas fa-file-alt"></i> .TXT</button>
                    <button class="btn-small" onclick="dlDoc()"><i class="fas fa-file-word"></i> .DOC</button>
                </div>
            </div>
            <textarea id="output" placeholder="Teks hasil scan akan muncul di sini..."></textarea>
        </div>
    </div>

    <div class="footer">
        &copy; 2026 Free OCR Tool. Privacy First.
    </div>
</div>

<script>
    // --- SETUP VARIABLES ---
    const fileIn = document.getElementById('fileIn');
    const previewBox = document.getElementById('previewBox');
    const startBtn = document.getElementById('startBtn');
    const statusBar = document.getElementById('statusBar');
    const resultArea = document.getElementById('resultArea');
    const output = document.getElementById('output');
    const langSelect = document.getElementById('langSelect');
    
    let files = [];

    // --- 1. SAAT FILE DIPILIH ---
    fileIn.addEventListener('change', (e) => {
        files = Array.from(e.target.files);
        previewBox.innerHTML = '';
        
        if(files.length > 0) {
            previewBox.style.display = 'flex';
            files.forEach(f => {
                const img = document.createElement('img');
                img.src = URL.createObjectURL(f);
                img.className = 'thumb';
                previewBox.appendChild(img);
            });
            startBtn.disabled = false;
            statusBar.style.display = 'block';
            statusBar.innerText = `${files.length} gambar dipilih. Siap scan.`;
        }
    });

    // --- 2. LOGIKA UTAMA (SCAN) ---
    startBtn.onclick = async () => {
        startBtn.disabled = true;
        startBtn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Sedang Memproses...';
        resultArea.style.display = 'block';
        output.value = "Memuat mesin AI...";
        
        const lang = langSelect.value;

        try {
            // Setup AI Worker
            const worker = await Tesseract.createWorker(lang, 1, {
                logger: m => {
                    if(m.status === 'recognizing text') {
                        statusBar.innerText = `Membaca Teks: ${Math.round(m.progress * 100)}%`;
                    } else {
                        statusBar.innerText = `Status: ${m.status}`;
                    }
                }
            });

            // Optimasi Akurasi
            await worker.setParameters({
                tessedit_pageseg_mode: '1',
                preserve_interword_spaces: '1',
            });

            let finalText = "";

            // Loop scan semua gambar
            for(let i=0; i<files.length; i++) {
                statusBar.innerText = `Scan gambar ${i+1} dari ${files.length}...`;
                const { data: { text } } = await worker.recognize(files[i]);
                finalText += text + "\n\n";
            }

            // Cek Bahasa Arab (RTL)
            if(lang.includes('ara') || /[\u0600-\u06FF]/.test(finalText)) {
                output.classList.add('rtl-mode');
            } else {
                output.classList.remove('rtl-mode');
            }

            output.value = finalText.trim();
            statusBar.innerText = "âœ… Selesai! Silakan download.";
            statusBar.style.color = "green";
            
            await worker.terminate();

        } catch (err) {
            console.error(err);
            statusBar.innerText = "âŒ Gagal memproses. Coba refresh halaman.";
            statusBar.style.color = "red";
        }

        // Reset Tombol
        startBtn.disabled = false;
        startBtn.innerHTML = '<i class="fas fa-magic"></i> Mulai Konversi';
    };

    // --- 3. FUNGSI DOWNLOAD ---
    function copyText() {
        output.select();
        document.execCommand('copy');
        alert("Teks berhasil disalin!");
    }

    function dlTxt() {
        if(!output.value) return;
        const blob = new Blob([output.value], {type: "text/plain;charset=utf-8"});
        saveAs(blob, "hasil-scan.txt");
    }

    function dlDoc() {
        if(!output.value) return;
        const isRtl = output.classList.contains('rtl-mode');
        const content = `
            <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
            <head><meta charset='utf-8'><title>Doc</title>
            <style>body{font-family:'Arial'; direction:${isRtl?'rtl':'ltr'};}</style>
            </head><body>${output.value.replace(/\n/g, "<br>")}</body></html>`;
        
        const blob = new Blob(['\ufeff', content], {type: 'application/msword'});
        saveAs(blob, "hasil-scan.doc");
    }
</script>

</body>
    </html>
