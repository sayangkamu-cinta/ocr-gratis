<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI OCR Pro: Arab, Turki & Latin</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <style>
        :root { --primary: #1a73e8; --bg: #fdfdfd; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; margin: 0; padding: 15px; }
        .container { max-width: 850px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); }
        header { text-align: center; border-bottom: 2px solid #eee; margin-bottom: 20px; padding-bottom: 10px; }
        .upload-box { border: 3px dashed #1a73e8; border-radius: 12px; padding: 30px; text-align: center; cursor: pointer; background: #f8faff; transition: 0.3s; }
        .upload-box:hover { background: #eef4ff; }
        #preview-img { max-width: 100%; height: auto; margin-top: 15px; border-radius: 8px; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        button { padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.2s; }
        .btn-run { background: var(--primary); color: white; }
        .btn-copy { background: #34a853; color: white; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .status-area { margin-top: 15px; font-size: 14px; color: #555; background: #fff3cd; padding: 8px; border-radius: 5px; display: none; }
        #output { width: 100%; height: 350px; margin-top: 20px; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 18px; line-height: 1.6; box-sizing: border-box; }
        /* Style khusus untuk Teks Arab */
        .rtl-mode { direction: rtl; text-align: right; font-family: 'Amiri', serif; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>AI Multi-Lang OCR</h1>
        <p>Optimasi: Arab (Harakat), Turki, Indonesia & Inggris</p>
    </header>

    <div class="upload-box" onclick="document.getElementById('inp').click()">
        <p>ðŸ“· Klik untuk Upload Gambar / Gunakan Kamera</p>
        <input type="file" id="inp" hidden accept="image/*">
        <img id="preview-img">
    </div>

    <div class="status-area" id="stat">Status: Menyiapkan AI...</div>

    <div class="controls">
        <button class="btn-run" id="runBtn" disabled>Mulai Scan (20 Workers)</button>
        <button class="btn-copy" id="copyBtn">Salin Teks</button>
    </div>

    <textarea id="output" placeholder="Hasil scan akan muncul di sini..."></textarea>
</div>

<script>
    const inp = document.getElementById('inp');
    const runBtn = document.getElementById('runBtn');
    const out = document.getElementById('output');
    const stat = document.getElementById('stat');
    const preview = document.getElementById('preview-img');

    inp.onchange = (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = () => {
                preview.src = reader.result;
                preview.style.display = 'block';
                runBtn.disabled = false;
                stat.style.display = 'block';
                stat.innerText = "Status: Gambar dimuat. Klik Mulai Scan.";
            };
            reader.readAsDataURL(file);
        }
    };

    runBtn.onclick = async () => {
        runBtn.disabled = true;
        out.value = "Sedang melakukan Visual Rescan... Mohon tunggu.";
        stat.innerText = "Status: Mengunduh data bahasa (Arab & Turki)...";

        try {
            // Mengaktifkan 20 Workers secara paralel untuk kecepatan tinggi
            const worker = await Tesseract.createWorker('ara+tur+eng+ind', 1, {
                logger: m => {
                    if(m.status === 'recognizing text') {
                        stat.innerText = `Status: Memproses Visual (${Math.round(m.progress * 100)}%)`;
                    }
                }
            });

            // Optimasi untuk teks Arab berharakat
            await worker.setParameters({
                tessedit_pageseg_mode: '1', // Automatic page segmentation
                preserve_interword_spaces: '1',
            });

            const { data: { text } } = await worker.recognize(preview.src);
            
            // Cek apakah ada karakter Arab, jika ya aktifkan mode RTL
            if (/[\u0600-\u06FF]/.test(text)) {
                out.classList.add('rtl-mode');
            } else {
                out.classList.remove('rtl-mode');
            }

            out.value = text;
            stat.innerText = "Status: Berhasil diekstrak!";
            await worker.terminate();
        } catch (err) {
            stat.innerText = "Status: Terjadi kesalahan teknis.";
            console.error(err);
        }
        runBtn.disabled = false;
    };

    document.getElementById('copyBtn').onclick = () => {
        out.select();
        document.execCommand('copy');
        alert("Teks berhasil disalin!");
    };
</script>

</body>
</html><div class="wrapper">
    <header>
        <h1>AI Multi-Format OCR</h1>
        <p>Mendukung: 
            <span class="format-badge">JPG/PNG</span><span class="format-badge">PDF</span>
            <span class="format-badge">WEBP</span><span class="format-badge">TIFF</span>
            <span class="format-badge">RAW</span><span class="format-badge">PSD/AI</span>
        </p>
    </header>

    <div class="drop-zone" id="dropZone">
        <p id="dropText">Tarik file ke sini atau klik untuk memilih file</p>
        <input type="file" id="fileInput" hidden accept=".jpg,.jpeg,.png,.bmp,.gif,.tiff,.webp,.pdf,.ai,.eps,.psd,.xps,.djvu,.cr2,.nef,.arw,.dng,.raf">
        <canvas id="preview-canvas"></canvas>
    </div>

    <div class="status-box">
        <div id="statusText">Status: Siap memproses.</div>
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <div class="btn-group">
        <button class="btn-primary" id="startBtn" disabled>Mulai Ekstraksi</button>
        <button class="btn-success" id="copyBtn">Salin Hasil</button>
    </div>

    <div class="output-area">
        <textarea id="outputField" placeholder="Hasil teks akan muncul di sini..."></textarea>
    </div>
</div>

<script>
    // Konfigurasi PDF.js Worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    const fileInput = document.getElementById('fileInput');
    const dropZone = document.getElementById('dropZone');
    const startBtn = document.getElementById('startBtn');
    const outputField = document.getElementById('outputField');
    const statusText = document.getElementById('statusText');
    const progressBar = document.getElementById('progressBar');
    const canvas = document.getElementById('preview-canvas');
    const ctx = canvas.getContext('2d');

    let currentFile = null;

    // Handle Klik & Drag-Drop
    dropZone.onclick = () => fileInput.click();
    fileInput.onchange = (e) => handleFile(e.target.files[0]);

    async function handleFile(file) {
        if (!file) return;
        currentFile = file;
        startBtn.disabled = false;
        statusText.innerText = `File terpilih: ${file.name}`;
        
        // Reset Preview
        canvas.style.display = 'none';
        
        // Jika Gambar Standar, tampilkan preview
        if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    canvas.style.display = 'block';
                }
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    }

    startBtn.onclick = async () => {
        if (!currentFile) return;
        startBtn.disabled = true;
        outputField.value = "Sedang memproses... Mohon tunggu.";
        
        if (currentFile.type === "application/pdf") {
            await processPDF(currentFile);
        } else {
            await processImage(currentFile);
        }
        startBtn.disabled = false;
    };

    // Fungsi OCR Image (Mendukung Multi-Worker Tesseract)
    async function processImage(file) {
        statusText.innerText = "Menginisialisasi AI Workers...";
        const worker = await Tesseract.createWorker('eng+ind', 1, {
            logger: m => {
                if (m.status === 'recognizing text') {
                    const progress = Math.round(m.progress * 100);
                    progressBar.style.width = progress + '%';
                    statusText.innerText = `Mengekstrak Teks: ${progress}%`;
                }
            }
        });

        const result = await worker.recognize(file);
        outputField.value = result.data.text;
        statusText.innerText = "Ekstraksi Selesai!";
        await worker.terminate();
    }

    // Fungsi OCR PDF (Konversi tiap halaman ke Canvas)
    async function processPDF(file) {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
        let fullText = "";

        for (let i = 1; i <= pdf.numPages; i++) {
            statusText.innerText = `Memproses Halaman PDF ${i} dari ${pdf.numPages}...`;
            const page = await pdf.getPage(i);
            const viewport = page.getViewport({ scale: 2 });
            canvas.width = viewport.width;
            canvas.height = viewport.height;

            await page.render({ canvasContext: ctx, viewport: viewport }).promise;
            
            // OCR per halaman
            const worker = await Tesseract.createWorker('eng+ind');
            const result = await worker.recognize(canvas);
            fullText += `--- Halaman ${i} ---\n${result.data.text}\n\n`;
            await worker.terminate();
        }
        
        outputField.value = fullText;
        statusText.innerText = "PDF Berhasil Diekstrak!";
    }

    // Copy Button
    document.getElementById('copyBtn').onclick = () => {
        outputField.select();
        document.execCommand('copy');
        alert("Teks disalin ke clipboard!");
    };
</script>

</body>

</html>
