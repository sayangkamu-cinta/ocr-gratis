<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro-OCR: All-in-One Image to Text</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    
    <style>
        :root { --primary: #2563eb; --secondary: #10b981; --dark: #1e293b; }
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; color: var(--dark); margin: 0; padding: 20px; }
        .wrapper { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        header { text-align: center; margin-bottom: 30px; }
        .format-badge { font-size: 0.7rem; background: #e2e8f0; padding: 3px 8px; border-radius: 4px; margin: 2px; display: inline-block; }
        
        .drop-zone { border: 3px dashed #cbd5e1; border-radius: 12px; padding: 40px; text-align: center; cursor: pointer; transition: 0.3s; background: #f8fafc; }
        .drop-zone:hover { border-color: var(--primary); background: #eff6ff; }
        
        .status-box { margin-top: 20px; padding: 15px; border-radius: 8px; background: #f8fafc; font-size: 0.9rem; }
        .progress-bar { height: 8px; width: 0%; background: var(--primary); border-radius: 4px; transition: 0.3s; margin-top: 10px; }
        
        .output-area { margin-top: 25px; }
        textarea { width: 100%; height: 300px; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; font-family: monospace; font-size: 14px; box-sizing: border-box; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--secondary); color: white; }
        button:disabled { background: #cbd5e1; cursor: not-allowed; }

        #preview-canvas { display: none; max-width: 100%; margin-top: 20px; border: 1px solid #ddd; }
    </style>
</head>
<body>

<div class="wrapper">
    <header>
        <h1>AI Multi-Format OCR</h1>
        <p>Mendukung: 
            <span class="format-badge">JPG/PNG</span><span class="format-badge">PDF</span>
            <span class="format-badge">WEBP</span><span class="format-badge">TIFF</span>
            <span class="format-badge">RAW</span><span class="format-badge">PSD/AI</span>
        </p>
    </header>

    <div class="drop-zone" id="dropZone">
        <p id="dropText">Tarik file ke sini atau klik untuk memilih file</p>
        <input type="file" id="fileInput" hidden accept=".jpg,.jpeg,.png,.bmp,.gif,.tiff,.webp,.pdf,.ai,.eps,.psd,.xps,.djvu,.cr2,.nef,.arw,.dng,.raf">
        <canvas id="preview-canvas"></canvas>
    </div>

    <div class="status-box">
        <div id="statusText">Status: Siap memproses.</div>
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <div class="btn-group">
        <button class="btn-primary" id="startBtn" disabled>Mulai Ekstraksi</button>
        <button class="btn-success" id="copyBtn">Salin Hasil</button>
    </div>

    <div class="output-area">
        <textarea id="outputField" placeholder="Hasil teks akan muncul di sini..."></textarea>
    </div>
</div>

<script>
    // Konfigurasi PDF.js Worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    const fileInput = document.getElementById('fileInput');
    const dropZone = document.getElementById('dropZone');
    const startBtn = document.getElementById('startBtn');
    const outputField = document.getElementById('outputField');
    const statusText = document.getElementById('statusText');
    const progressBar = document.getElementById('progressBar');
    const canvas = document.getElementById('preview-canvas');
    const ctx = canvas.getContext('2d');

    let currentFile = null;

    // Handle Klik & Drag-Drop
    dropZone.onclick = () => fileInput.click();
    fileInput.onchange = (e) => handleFile(e.target.files[0]);

    async function handleFile(file) {
        if (!file) return;
        currentFile = file;
        startBtn.disabled = false;
        statusText.innerText = `File terpilih: ${file.name}`;
        
        // Reset Preview
        canvas.style.display = 'none';
        
        // Jika Gambar Standar, tampilkan preview
        if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    canvas.style.display = 'block';
                }
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    }

    startBtn.onclick = async () => {
        if (!currentFile) return;
        startBtn.disabled = true;
        outputField.value = "Sedang memproses... Mohon tunggu.";
        
        if (currentFile.type === "application/pdf") {
            await processPDF(currentFile);
        } else {
            await processImage(currentFile);
        }
        startBtn.disabled = false;
    };

    // Fungsi OCR Image (Mendukung Multi-Worker Tesseract)
    async function processImage(file) {
        statusText.innerText = "Menginisialisasi AI Workers...";
        const worker = await Tesseract.createWorker('eng+ind', 1, {
            logger: m => {
                if (m.status === 'recognizing text') {
                    const progress = Math.round(m.progress * 100);
                    progressBar.style.width = progress + '%';
                    statusText.innerText = `Mengekstrak Teks: ${progress}%`;
                }
            }
        });

        const result = await worker.recognize(file);
        outputField.value = result.data.text;
        statusText.innerText = "Ekstraksi Selesai!";
        await worker.terminate();
    }

    // Fungsi OCR PDF (Konversi tiap halaman ke Canvas)
    async function processPDF(file) {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
        let fullText = "";

        for (let i = 1; i <= pdf.numPages; i++) {
            statusText.innerText = `Memproses Halaman PDF ${i} dari ${pdf.numPages}...`;
            const page = await pdf.getPage(i);
            const viewport = page.getViewport({ scale: 2 });
            canvas.width = viewport.width;
            canvas.height = viewport.height;

            await page.render({ canvasContext: ctx, viewport: viewport }).promise;
            
            // OCR per halaman
            const worker = await Tesseract.createWorker('eng+ind');
            const result = await worker.recognize(canvas);
            fullText += `--- Halaman ${i} ---\n${result.data.text}\n\n`;
            await worker.terminate();
        }
        
        outputField.value = fullText;
        statusText.innerText = "PDF Berhasil Diekstrak!";
    }

    // Copy Button
    document.getElementById('copyBtn').onclick = () => {
        outputField.select();
        document.execCommand('copy');
        alert("Teks disalin ke clipboard!");
    };
</script>

</body>
</html>